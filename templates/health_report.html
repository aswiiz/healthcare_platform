{% extends "base.html" %}

{% block title %}AI Comprehensive Health Report - Healthcare Hub{% endblock %}

{% block content %}
<div class="hero">
    <h1>Advanced AI Health Report</h1>
    <p>Our simulation has processed your 20+ metrics to provide the following diagnostic probabilities.</p>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; width: 100%; max-width: 1100px;">
    <!-- Column 1: Metrics Overview -->
    <div class="card" style="max-width: 100%;">
        <h3>Raw Metrics Summary</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; font-size: 0.9rem;">
            <div style="padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 8px;"><strong>Sex:</strong>
                {{ record['sex'] }}</div>
            <div style="padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 8px;"><strong>BMI:</strong>
                {{ analysis['bmi'] }}</div>
            <div style="padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 8px;"><strong>BP:</strong> {{
                record['bp_systolic'] }}/{{ record['bp_diastolic'] }} ({{ analysis['bp_status'] }})</div>
            <div style="padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 8px;"><strong>Sugar:</strong>
                {{ analysis['sugar_status'] }}</div>
            <div style="padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 8px;"><strong>HbA1c:</strong>
                {{ record['hba1c'] }}%</div>
            <div style="padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 8px;">
                <strong>Glucose:</strong> {{ record['fasting_glucose'] }} mg/dL
            </div>
            <div style="padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 8px;">
                <strong>Cholesterol:</strong> {{ record['cholesterol'] }}
            </div>
            <div style="padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 8px;"><strong>LDL:</strong>
                {{ record['ldl'] }}</div>
            <div style="padding: 0.5rem; background: rgba(255,255,255,0.2); border-radius: 8px;">
                <strong>Triglycerides:</strong> {{ record['triglycerides'] }}
            </div>
        </div>
        <div style="margin-top: 2rem;">
            <h4>Lifestyles</h4>
            <p style="font-size: 0.85rem; opacity: 0.8;">Smoking: {{ record['smoking'] }} | Alcohol: {{
                record['alcohol'] }} | Activity: {{ record['activity'] }}</p>
        </div>
    </div>

    <!-- Column 2: AI Predictions -->
    <div class="card" style="max-width: 100%; border-left: 6px solid var(--primary-color);">
        <h3>Disease Probabilities</h3>
        <div style="margin-top: 1.5rem;">
            {% for cond in analysis['conditions'] %}
            <div style="margin-bottom: 1.5rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span style="font-weight: 700;">{{ cond['condition'] }}</span>
                    <span
                        style="font-weight: 800; color: {% if cond['probability'] > 60 %}var(--danger-color){% elif cond['probability'] > 30 %}#f39c12{% else %}var(--success-color){% endif %};">
                        {{ cond['probability'] }}%
                    </span>
                </div>
                <!-- Progress Bar -->
                <div
                    style="width: 100%; height: 10px; background: rgba(0,0,0,0.1); border-radius: 5px; overflow: hidden;">
                    <div
                        style="width: {{ cond['probability'] }}%; height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));">
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if analysis['needs_doctor'] %}
        <div
            style="background: var(--accent-color); color: white; padding: 1.5rem; border-radius: 15px; margin-top: 2rem;">
            <h4 style="color: white; margin-bottom: 0.5rem;">Critical Alert!</h4>
            <p style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 1rem;">Our AI model indicates significant risk
                factors that require medical attention.</p>
            <form action="{{ url_for('book_consultation') }}" method="POST">
                <button type="submit" class="btn" style="background: white; color: var(--accent-color);">Consult Doctor
                    & Book OP</button>
            </form>
        </div>
        {% else %}
        <div
            style="background: var(--success-color); color: white; padding: 1.5rem; border-radius: 15px; margin-top: 2rem; text-align: center;">
            <h4 style="color: white;">Looking Good!</h4>
            <p style="font-size: 0.9rem;">Your current metrics are within safe ranges for most identified conditions.
            </p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}