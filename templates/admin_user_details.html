{% extends "base.html" %}

{% block title %}User Details - Admin Hub{% endblock %}

{% block content %}
<div class="hero" style="max-width: 1000px;">
    <h1>User Profile: {{ user['name'] }}</h1>
    <p>Viewing comprehensive history for <strong>@{{ user['username'] }}</strong></p>
</div>

<div style="width: 100%; max-width: 1100px;">
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary"
        style="width: 200px; margin-bottom: 2rem;">&larr; Back to List</a>

    <div class="card" style="max-width: 100%; margin-bottom: 2rem;">
        <h3>Base Information</h3>
        <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
            <p><strong>Age:</strong> {{ user['age'] }}</p>
            <p><strong>Gender:</strong> {{ user['gender'] }}</p>
            <p><strong>Phone:</strong> {{ user['phone'] }}</p>
            <p><strong>Blood Group:</strong> {{ user['blood_group'] }}</p>
            <p><strong>Address:</strong> {{ user['address'] }}</p>
        </div>
    </div>

    <h3>Complete Medical & History Logs</h3>
    {% for record in records %}
    <div class="card"
        style="max-width: 100%; margin-top: 1.5rem; border-left: 8px solid {% if record.analysis.needs_doctor %}var(--danger-color){% else %}var(--success-color){% endif %};">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
            <div>
                <h4 style="margin: 0;">Submission ID: #{{ record.data['id'] }}</h4>
                <small style="opacity: 0.6;">{{ record.data['date'] }}</small>
            </div>
            <span
                style="font-size: 0.75rem; font-weight: 800; padding: 0.4rem 0.8rem; background: rgba(0,0,0,0.05); border-radius: 20px;">
                {% if record.analysis.needs_doctor %}ACTION REQUIRED{% else %}HEALTHY{% endif %}
            </span>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 2rem;">
            <!-- Bio & Lifestyle -->
            <div>
                <h5 style="color: var(--secondary-color); margin-bottom: 0.5rem;">Background & Life</h5>
                <p style="font-size: 0.85rem;"><strong>Sex:</strong> {{ record.data['sex'] }}</p>
                <p style="font-size: 0.85rem;"><strong>Family:</strong> {{ record.data['family_history'] }}</p>
                <p style="font-size: 0.85rem;"><strong>Lifestyle:</strong> Smoke:{{ record.data['smoking'] }} | Alc:{{
                    record.data['alcohol'] }}</p>
                <p style="font-size: 0.85rem;"><strong>Env:</strong> {{ record.data['environmental'] }} Exposure</p>
            </div>

            <!-- Measurements -->
            <div>
                <h5 style="color: var(--secondary-color); margin-bottom: 0.5rem;">Biometrics & Labs</h5>
                <p style="font-size: 0.85rem;"><strong>BP:</strong> {{ record.data['bp_systolic'] }}/{{
                    record.data['bp_diastolic'] }}</p>
                <p style="font-size: 0.85rem;"><strong>BMI:</strong> {{ record.analysis['bmi'] }} (Waist: {{
                    record.data['waist'] }}cm)</p>
                <p style="font-size: 0.85rem;"><strong>Glucose/A1c:</strong> {{ record.data['fasting_glucose'] }} / {{
                    record.data['hba1c'] }}%</p>
                <p style="font-size: 0.85rem;"><strong>Lipids:</strong> Chol:{{ record.data['cholesterol'] }} | LDL:{{
                    record.data['ldl'] }} | HDL:{{ record.data['hdl'] }}</p>
            </div>

            <!-- AI Output -->
            <div style="background: rgba(0,0,0,0.03); padding: 1rem; border-radius: 10px;">
                <h5 style="margin-bottom: 0.5rem;">AI Risk Assessment</h5>
                {% for cond in record.analysis.conditions %}
                <div style="font-size: 0.85rem; display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                    <span>{{ cond.condition }}</span>
                    <span style="font-weight: 700;">{{ cond.probability }}%</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% else %}
    <p style="text-align: center; margin-top: 3rem; color: var(--secondary-color);">No health data records found.</p>
    {% endfor %}
</div>
{% endblock %}